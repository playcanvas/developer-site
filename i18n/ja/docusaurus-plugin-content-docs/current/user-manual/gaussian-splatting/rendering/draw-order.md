---
title: 描画順序とソート
sidebar_position: 1
---

## ガウスがソートされる仕組み

GSplatComponent内の個々のガウスは、カメラの深度に基づいて奥から手前へとソートされます。このソートは、メインスレッドをブロックしないように、Web Workerで非同期に行われます。計算されたソート順はその後メインスレッドに渡され、レンダリングのためにGPUにアップロードされます。

:::note

ソートは非同期で行われるため、Web Workerが新しいソート順を再計算するのに時間が必要なため、非常に短い期間でカメラの変換が大きく変化した場合、視覚的なラグが発生する可能性があります。

:::

## 複数のGSplatComponent

GSplatComponentは、そのバウンディングボックスに基づいて奥から手前へとレンダリングされ、各コンポーネントのガウスは、そのコンポーネント内で独立してソートされます。

:::info グローバルソート

PlayCanvas Engineは現在、複数のGSplatComponent間での「グローバルソート」（すべてのコンポーネントのすべてのガウスがまとめてソートされる）をサポートしていません。これに対するサポートは[現在開発中です](https://x.com/ValigurskyM/status/1940401991836131702)。進捗状況を把握するには、[このプルリクエスト](https://github.com/playcanvas/engine/pull/7825)を購読してください。

:::

## 深度バッファに関する考慮事項

GSplatComponentはレンダリング中に深度バッファに書き込みません。この制限は、アプリケーションで深度バッファデータの読み戻しや活用に依存する機能を使用できないことを意味します。たとえば、通常は深度バッファを必要とするDepth of Fieldポストエフェクトは、スプラットレンダリングと一般的に互換性がありません。

回避策として、スプラットのメッシュベースの近似を生成し、それを別のレイヤーで深度バッファにレンダリングできます（フレームバッファには書き込みません）。この手法により、ガウススプラットレンダリングの視覚的品質を維持しながら、深度に依存するエフェクトを可能にします。
