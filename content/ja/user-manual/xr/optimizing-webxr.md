---
title: WebXRアプリの最適化
layout: usermanual-page.hbs
position: 5
---

## はじめに

高く一貫したフレームレートは、楽しいXR体験をするために不可欠です。VR / ARコンテンツを作成する際には、早期にテストして最適化することが重要であり、開発の間ずっと目標フレームレートを維持することがさらに重要です。

ARの場合、世界、画像、顔追跡エフェクトによって性能コストがかかるため、フレームレートは注意深く管理する必要があります。これは、ほとんどのユーザーがアクセスできる性能制限のあるモバイルハードウェアに追加されます。

VRの場合、シーンを各ビュー(アイ)ごとに1回レンダリングする必要があるため、レンダリングは特に高価です。 PlayCanvasは、VRレンダリングが完全に重複しないように高度に最適化されていますが、ステレオレンダリングはモノクロームレンダリングよりも高価です。

さらに、Oculus RiftやHTC Viveのようなデバイスは、75Hzまたは90Hzなど、高いフレームレートを要求します。モバイルVRは高いフレームレートを必要としないが、歪みエフェクトのネイティブサポートがないため、JavaScriptとWebGLレイヤーに追加のオーバーヘッドがかかる。

ただし、PlayCanvasには、アプリケーションがより短時間でより多くのことを行うために特別に設計された機能がいくつか含まれています。

### ランタイムライトマップの生成

各動的ライトにはフレームあたりの実行時コストがあります。ライトが多いほどコストが高く、シーンをレンダリングする速度が遅くなります。ライトをライトマップにベイクすることで、静的ライトのコストを単にテクスチャをレンダリングするコストに大幅に削減できます。ライトマップは、お気に入りの3Dモデリングツールを使用してオフラインで生成できるか、PlayCanvasの組み込みのランタイムライトマップ生成を使用できます。

[ランタイムライトマップの生成について詳しく読む][1]。

### リアルタイムシャドウの注意深い使用

動的ライトと同様の理由で、動的シャドウにもフレームあたりの実行時コストがあります。特にオムニライトの場合、シーンを6回レンダリングしてシャドウを生成する必要があります。多くの光が動的シャドウを投影しないようにする必要があります。

### フィルレートとオーバードローに注意する

フィルレートは、画面の各ピクセルに適用されるシェーダー操作の数を示します。高価なフラグメントシェーダーの計算(多数のライトと複雑なマテリアルなど)と高解像度(高いデバイスピクセル比を持つモバイル電話など)がある場合、アプリケーションは高いフレームレートを維持するためにシーンをレンダリングするのにあまりにも多くの時間を費やします。

オーバードローとは、カメラに近い他のジオメトリによってオクルージョンされたジオメトリを描画することで上書きされるピクセルの数を示します。オーバードローが多すぎると、見えないピクセルを描画しようとしてGPU処理を無駄にしていることがわかります。

[WebGL Insight][2]のような拡張機能を使用すると、オーバードローを視覚化して確認できます。

### ガベージコレクションスタールの対策

Webブラウザには、使用されていないJavaScriptオブジェクトの自動ガベージコレクション機能があります。PlayCanvasエンジンは、ランタイムの割り当てを最小限に抑えるように設計されており、コードでも同じことを試みる必要があります。事前にベクトルやその他のオブジェクトを割り当てて再利用し、フレームごとに作成されたり破棄されたりするオブジェクトが多くならないようにする必要があります。

### プロファイリングツール

PlayCanvasには組み込みのプロファイラツールがあります。エディタでLaunch Profilerボタンを使用して、プロファイリングが有効な状態でアプリケーションを実行できます。

### [プロファイラについて詳しく読む][3]

一般的な最適化のヒント

[1]: /user-manual/graphics/lighting/runtime-lightmaps/
[2]: https://github.com/3Dparallax/insight
[3]: /user-manual/optimization/profiler/
[4]: /user-manual/optimization/guidelines/
