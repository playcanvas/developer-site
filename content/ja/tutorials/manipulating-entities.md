---
title: エンティティの操作
layout: tutorial-page.hbs
tags: basics
thumb: "https://s3-eu-west-1.amazonaws.com/images.playcanvas.com/projects/12/186/KM6GIE-image-75.jpg"
---

このチュートリアルでは、エンティティの位置、向き、スケールを変更する方法を説明します。

エンティティは、PlayCanvasフレームワークを使用して構築されたほとんどのアプリケーションの基礎を形成します。エンティティはプレイヤーキャラクターや弾丸、敵など何でも表現でき、あるいは単に空間内のポイントになります。

エンティティは特別な形式のグラフノードであり、 `pc.GraphNode`から多くの振る舞いを継承します。以下で適用するすべての変更は、グラフノードにも適用できます。

エンティティに対して行う最も一般的な操作の1つは、変換行列を変更することです。エンティティのローカル変換プロパティは、エンティティの位置、向き、スケールを決定し、すべての子エンティティに影響を与えます。変換を操作する方法を学ぶことは、興味深くインタラクティブなアプリケーションを作成するために重要です。

### ローカルとワールド座標

エンティティを移動して操作する方法を理解する重要な部分は、ローカル座標系とワールド座標系の理解です。ワールド座標系はすべてのエンティティで共有され、固定された原点`(0,0,0)`と 固定の向きがあります。その方向の `(0,1,0)` が上です。ローカル座標は、エンティティ自体に対して相対的な座標系です。つまり、ローカル原点はエンティティの位置であり、向きはエンティティの向きに従います。

<img loading="lazy" src="/images/tutorials/world.jpg" style="float:left;" alt="ワールド座標">
<img loading="lazy" src="/images/tutorials/local.jpg" style="float:right;" alt="ローカル座標">
<div style="clear:both"></div>

*ワールド座標系とローカル座標系*

### 階層

エンティティシステムの理解する上で重要な部分は、エンティティグラフまたは階層です。エンティティは、親子の親密な関係があるグラフノードの一種です。各エンティティには1つの親と複数の子があります。子エンティティは、親から変換情報を継承します。エンティティのワールド変換行列は、ローカル変換を親エンティティのワールド変換に乗算して計算されます。たとえば、子エンティティのローカル変換が `(1、0、0)` の移動を表し、親エンティティのローカル変換が `(0、1、0)` の移動を表す場合、子エンティティのワールド位置は `(1、1、0)` になります。

## 位置

エンティティの位置を取得するには、下記のように書きます。

```javascript
// エンティティの相対位置を取得する
var lp = entity.getLocalPosition();

// エンティティのワールド空間内の位置を取得する
var wp = entity.getPosition();
```

これらの方法はともに ` pc.Vec3`(配列形式のベクトル量[x、y、z])を返します。

エンティティの位置を設定するには、下記の方法を使用するだけです。

```javascript
// エンティティの相対位置を設定する
entity.setLocalPosition(x、y、z);

// エンティティのワールド空間内の位置を設定する
entity.setPosition(x、y、z);
```

### エンティティの移動

エンティティを移動するには、エンティティの位置に加算するか、ヘルパー関数 `translate` および `translateLocal` を使用することができます。

```javascript
// エンティティをワールド空間の正のx軸方向に1ユニット移動する
entity.translate(1, 0, 0);

// エンティティをエンティティのローカルz軸方向に1ユニット移動する
entity.translateLocal(0、0、1);
```

## 向き

エンティティの向きを設定するには、絶対回転を設定するか、増分回転を適用することができます。

絶対回転は、[オイラー角][1]または[クォータニオン][2]を使用して行うことができます。回転のこれらの2つの数学的表現に関するWikipediaの説明は少し分かりにくいですが、基本的な考え方は簡単です。以下が重要な事実です。

**オイラー角**

* オイラー角は、座標系のX、Y、およびZ軸の周りの3つの回転(その順で角度)です。
* 座標系の軸を見下ろす場合、正のオイラー角は、その軸を中心に反時計回りに回転します。
* オイラー角はわかりやすいため、その影響を頭で視覚化できます。

**クォータニオン**

* クォータニオンは4つの数字として格納され、3D空間の任意の向きを表します。
* 直接設定することは困難ですが、オイラー角、回転行列、または軸角度表現から設定できます。
* 視覚化するのは難しいですが、頑健で回転を素早く補完できるので便利です(回転をアニメーション化する場合)。

エンティティのスクリプト化時、オイラー角を使用してエンティティの回転を設定することがより可能性が高いことがあります。例えば:

```javascript
// 親エンティティ座標系のX軸を中心に反時計回りに30度回転し、
// 次にY軸を中心に45度回転し、最後にZ軸を中心に60度回転します。
entity.setLocalEulerAngles(30、45、60);

// ワールド空間のX軸を中心に反時計回りに30度回転し、
// 次にY軸を中心に45度回転し、最後にZ軸を中心に60度回転します。
entity.setEulerAngles(30、45、60);
```

ただし、クォータニオン形式でエンティティの回転角度を設定する場合、次の関数を使用できます。

```javascript
// 単位回転クォータニオンを作成
var q = new pc.Quat();
// 親エンティティと同じ回転を持つようにエンティティを設定します。-等しい
// 開始時エンティティ.setLocalEulerAngles(0、0、0)
entity.setLocalRotation(q);

// エンティティの回転を、ワールドスペース座標系に対する回転なしとして設定します。
// - 等価 entity.setEulerAngles(0, 0, 0)。
entity.setRotation(q)。
```

エンティティを増分的に回転させるには、 `rotate` を使用してエンティティをワールド空間の軸に対して回転させ、 `rotateLocal` を使用してエンティティの現在の軸に対して回転させます。

たとえば、ワールド空間のアップ軸を中心にエンティティを180度回転するには次のようにします。

```javascript
entity.rotate(0、180、0

または、ローカルX軸の周りにエンティティを90度回転させるには：

```javascript
entity.rotateLocal(90, 0, 0);
```

## スケール

エンティティを拡大縮小するには次の関数を呼び出します：

```javascript
// ローカルY軸でエンティティを2の倍数でスケール
entity.setLocalScale(1, 2, 1);
```

もう少し興味深い例を紹介します：

```javascript
// 時間上でsine関数を使用してエンティティをスケール
this.timer += deltaTime;
var s = Math.sin(this.timer) + 1;
entity.setLocalScale(s, s, s);
```

現在、ワールド空間でエンティティのスケールを設定することはできません。

[1]: https://en.wikipedia.org/wiki/Euler_angles
[2]: https://en.wikipedia.org/wiki/Quaternion
