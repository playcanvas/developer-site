"use strict";(self.webpackChunkdeveloper_playcanvas_com=self.webpackChunkdeveloper_playcanvas_com||[]).push([[55528],{5320:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>p});const r=JSON.parse('{"id":"user-manual/scripting/fundamentals/events","title":"Events","description":"Events are a useful way of communicating between scripts in order to respond to things that happen without checking every frame.","source":"@site/docs/user-manual/scripting/fundamentals/events.md","sourceDirName":"user-manual/scripting/fundamentals","slug":"/user-manual/scripting/fundamentals/events","permalink":"/user-manual/scripting/fundamentals/events","draft":false,"unlisted":false,"editUrl":"https://github.com/playcanvas/developer.playcanvas.com/tree/dev/docs/user-manual/scripting/fundamentals/events.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"Events","sidebar_position":7},"sidebar":"userManualSidebar","previous":{"title":"Calling the Engine API","permalink":"/user-manual/scripting/fundamentals/engine-api"},"next":{"title":"Scripting for Editor Users","permalink":"/user-manual/scripting/editor-users/"}}');var s=t(74848),a=t(28453),i=t(65537),l=t(79329);const o={title:"Events",sidebar_position:7},c=void 0,u={},p=[{value:"Using Events",id:"using-events",level:2},{value:"Application Events",id:"application-events",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Events are a useful way of communicating between scripts in order to respond to things that happen without checking every frame."}),"\n",(0,s.jsxs)(n.p,{children:["Many PlayCanvas object types (such as script instances) have event handling support built-in, inherited from the Engine's ",(0,s.jsx)(n.a,{href:"https://api.playcanvas.com/engine/classes/EventHandler.html",children:(0,s.jsx)(n.code,{children:"EventHandler"})})," class. Event handling objects have the following methods:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"on()"})," - registers an event listener."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"once()"})," - registers an event listener that unregisters itself after the first time it is called."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"off()"})," - unregisters an event listener."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fire()"})," - sends an event."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"hasEvent()"})," - queries whether an object is listening on a particular event."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"using-events",children:"Using Events"}),"\n",(0,s.jsxs)(n.p,{children:["Trigger an event using ",(0,s.jsx)(n.code,{children:"fire()"}),". In this example, the player script fires a ",(0,s.jsx)(n.code,{children:"move"})," event every frame with the ",(0,s.jsx)(n.code,{children:"x"})," and ",(0,s.jsx)(n.code,{children:"y"})," values passed as arguments."]}),"\n","\n",(0,s.jsxs)(i.A,{defaultValue:"esm",groupId:"script-code",children:[(0,s.jsx)(l.A,{value:"esm",label:"ESM",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { Script } from 'playcanvas';\n\nexport class Player extends Script {\n    update(dt) {\n        const x = 1;\n        const y = 1;\n        this.fire('move', x, y);\n    }\n}\n"})})}),(0,s.jsx)(l.A,{value:"classic",label:"Classic",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"var Player = pc.createScript('player');\n\nPlayer.prototype.update = function (dt) {\n    const x = 1;\n    const y = 1;\n    this.fire('move', x, y);\n};\n"})})})]}),"\n",(0,s.jsxs)(n.p,{children:["Listen for events firing by using ",(0,s.jsx)(n.code,{children:"on()"})," and ",(0,s.jsx)(n.code,{children:"off()"}),". In this example, the display script listens for the ",(0,s.jsx)(n.code,{children:"move"})," event on the player and prints out the x and y values."]}),"\n",(0,s.jsxs)(i.A,{defaultValue:"esm",groupId:"script-code",children:[(0,s.jsx)(l.A,{value:"esm",label:"ESM",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { Script } from 'playcanvas';\n\nexport class Display extends Script {\n    /**\n     * @attribute\n     * @type {Entity}\n     */\n    playerEntity;\n\n    initialize() {\n        // Method to call when player moves\n        const onPlayerMove = (x, y) => {\n            console.log(x, y);\n        };\n\n        // Listen for the player move event\n        if (this.playerEntity && this.playerEntity.script && this.playerEntity.script.player) {\n            this.playerEntity.script.player.on('move', onPlayerMove);\n\n            // Remove player move event listeners when script destroyed\n            this.playerEntity.script.player.once('destroy', () => {\n                this.playerEntity.script.player.off('move', onPlayerMove);\n            });\n        }\n    }\n}\n"})})}),(0,s.jsx)(l.A,{value:"classic",label:"Classic",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"var Display = pc.createScript('display');\n\n// Set up an entity reference for the player entity\nDisplay.attributes.add('playerEntity', { type: 'entity' });\n\nDisplay.prototype.initialize = function () {\n    // Method to call when player moves\n    const onPlayerMove = (x, y) => {\n        console.log(x, y);\n    };\n\n    // Listen for the player move event\n    this.playerEntity.script.player.on('move', onPlayerMove);\n\n    // Remove player move event listeners when script destroyed\n    this.playerEntity.script.player.once('destroy', () => {\n        this.playerEntity.script.player.off('move', onPlayerMove);\n    });\n};\n"})})})]}),"\n",(0,s.jsx)(n.h2,{id:"application-events",children:"Application Events"}),"\n",(0,s.jsxs)(n.p,{children:['There is a very convenient and powerful method of using events to communicate between entities that we call "Application Events". As you can see in the example above, listening for events on specific entities incurs some set up cost. For instance, the listener must have a reference to the specific entity that is firing the event. This works with some cases, but for a more general case we find that it is more appropriate to use the main application (',(0,s.jsx)(n.code,{children:"this.app"}),") as a central hub for firing events. This means you don't have to keep references of entities around in order to use the events."]}),"\n",(0,s.jsxs)(n.p,{children:["This works by firing and listening to all events on ",(0,s.jsx)(n.code,{children:"this.app"}),". By convention, we use namespaces in event names in order to signal event scope and prevent clashes. For example, the ",(0,s.jsx)(n.code,{children:"player:move"})," event is fired on the application instead of firing the ",(0,s.jsx)(n.code,{children:"move"})," event on the player."]}),"\n",(0,s.jsx)(n.p,{children:"Let's try the same example using application events."}),"\n",(0,s.jsxs)(n.p,{children:["Firing the ",(0,s.jsx)(n.code,{children:"player:move"})," event:"]}),"\n",(0,s.jsxs)(i.A,{defaultValue:"esm",groupId:"script-code",children:[(0,s.jsx)(l.A,{value:"esm",label:"ESM",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { Script } from 'playcanvas';\n\nexport class Player extends Script {\n    update(dt) {\n        var x = 1;\n        var y = 1;\n        this.app.fire('player:move', x, y);\n    }\n}\n\nexport class Display extends Script {\n    initialize() {\n        // Method to call when player moves\n        const onPlayerMove = (x, y) => {\n            console.log(x, y);\n        };\n\n        // Listen for the player:move event\n        this.app.on('player:move', onPlayerMove);\n\n        // Remove player:move event listeners when script destroyed\n        this.on('destroy', () => {\n            this.app.off('player:move', onPlayerMove);\n        });\n    }\n}\n"})})}),(0,s.jsxs)(l.A,{value:"classic",label:"Classic",children:[(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"var Player = pc.createScript('player');\n\nPlayer.prototype.update = function (dt) {\n    const x = 1;\n    const y = 1;\n    this.app.fire('player:move', x, y);\n};\n"})}),(0,s.jsxs)(n.p,{children:["Listening for the ",(0,s.jsx)(n.code,{children:"player:move"})," event:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"var Display = pc.createScript('display');\n\nDisplay.prototype.initialize = function () {\n    // Method to call when player moves\n    const onPlayerMove = (x, y) => {\n        console.log(x, y);\n    };\n\n    // Listen for the player:move event\n    this.app.on('player:move', onPlayerMove);\n\n    // Remove player:move event listeners when script destroyed\n    this.on('destroy', function() {\n        this.app.off('player:move', onPlayerMove);\n    });\n};\n"})})]})]}),"\n",(0,s.jsx)(n.p,{children:"As you can see, this reduces the amount of set up and makes for cleaner code."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var r=t(96540);const s={},a=r.createContext(s);function i(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:n},e.children)}},65537:(e,n,t)=>{t.d(n,{A:()=>w});var r=t(96540),s=t(34164),a=t(65627),i=t(56347),l=t(50372),o=t(30604),c=t(11861),u=t(78749);function p(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function d(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return p(e).map((({props:{value:e,label:n,attributes:t,default:r}})=>({value:e,label:n,attributes:t,default:r})))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function h({value:e,tabValues:n}){return n.some((n=>n.value===e))}function v({queryString:e=!1,groupId:n}){const t=(0,i.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,o.aZ)(s),(0,r.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(t.location.search);n.set(s,e),t.replace({...t.location,search:n.toString()})}),[s,t])]}function y(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,a=d(e),[i,o]=(0,r.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:a}))),[c,p]=v({queryString:t,groupId:s}),[y,m]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,s]=(0,u.Dv)(n);return[t,(0,r.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:s}),f=(()=>{const e=c??y;return h({value:e,tabValues:a})?e:null})();(0,l.A)((()=>{f&&o(f)}),[f]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!h({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);o(e),p(e),m(e)}),[p,m,a]),tabValues:a}}var m=t(9136);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(74848);function g({className:e,block:n,selectedValue:t,selectValue:r,tabValues:i}){const l=[],{blockElementScrollPositionUntilNextRender:o}=(0,a.a_)(),c=e=>{const n=e.currentTarget,s=l.indexOf(n),a=i[s].value;a!==t&&(o(n),r(a))},u=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:i.map((({value:e,label:n,attributes:r})=>(0,x.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{l.push(e)},onKeyDown:u,onClick:c,...r,className:(0,s.A)("tabs__item",f.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function b({lazy:e,children:n,selectedValue:t}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function j(e){const n=y(e);return(0,x.jsxs)("div",{className:(0,s.A)("tabs-container",f.tabList),children:[(0,x.jsx)(g,{...n,...e}),(0,x.jsx)(b,{...n,...e})]})}function w(e){const n=(0,m.A)();return(0,x.jsx)(j,{...e,children:p(e.children)},String(n))}},79329:(e,n,t)=>{t.d(n,{A:()=>i});t(96540);var r=t(34164);const s={tabItem:"tabItem_Ymn6"};var a=t(74848);function i({children:e,hidden:n,className:t}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,t),hidden:n,children:e})}}}]);