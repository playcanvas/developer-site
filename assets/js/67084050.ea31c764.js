"use strict";(self.webpackChunkdeveloper_playcanvas_com=self.webpackChunkdeveloper_playcanvas_com||[]).push([[69681],{1840:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/add_condition-9b6b2f767dc391d171f44398da361dc8.png"},10903:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/initial_editor-ecb55173042f14cfadc5c9b79e4dc705.png"},11237:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/new_anim_component-7edabe1d37fd3d44d6cd92a733629783.png"},11470:(e,t,n)=>{n.d(t,{A:()=>j});var a=n(96540),i=n(34164),s=n(23104),r=n(56347),o=n(205),l=n(57485),c=n(31682),h=n(70679);function d(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function u(e){const{values:t,children:n}=e;return(0,a.useMemo)(()=>{const e=t??function(e){return d(e).map(({props:{value:e,label:t,attributes:n,default:a}})=>({value:e,label:t,attributes:n,default:a}))}(n);return function(e){const t=(0,c.XI)(e,(e,t)=>e.value===t.value);if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,n])}function p({value:e,tabValues:t}){return t.some(t=>t.value===e)}function m({queryString:e=!1,groupId:t}){const n=(0,r.W6)(),i=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,l.aZ)(i),(0,a.useCallback)(e=>{if(!i)return;const t=new URLSearchParams(n.location.search);t.set(i,e),n.replace({...n.location,search:t.toString()})},[i,n])]}function b(e){const{defaultValue:t,queryString:n=!1,groupId:i}=e,s=u(e),[r,l]=(0,a.useState)(()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find(e=>e.default)??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:s})),[c,d]=m({queryString:n,groupId:i}),[b,f]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,i]=(0,h.Dv)(t);return[n,(0,a.useCallback)(e=>{t&&i.set(e)},[t,i])]}({groupId:i}),g=(()=>{const e=c??b;return p({value:e,tabValues:s})?e:null})();(0,o.A)(()=>{g&&l(g)},[g]);return{selectedValue:r,selectValue:(0,a.useCallback)(e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),f(e)},[d,f,s]),tabValues:s}}var f=n(92303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var y=n(74848);function w({className:e,block:t,selectedValue:n,selectValue:a,tabValues:r}){const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),c=e=>{const t=e.currentTarget,i=o.indexOf(t),s=r[i].value;s!==n&&(l(t),a(s))},h=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=o.indexOf(e.currentTarget)+1;t=o[n]??o[0];break}case"ArrowLeft":{const n=o.indexOf(e.currentTarget)-1;t=o[n]??o[o.length-1];break}}t?.focus()};return(0,y.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":t},e),children:r.map(({value:e,label:t,attributes:a})=>(0,y.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{o.push(e)},onKeyDown:h,onClick:c,...a,className:(0,i.A)("tabs__item",g.tabItem,a?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function v({lazy:e,children:t,selectedValue:n}){const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===n);return e?(0,a.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,y.jsx)("div",{className:"margin-top--md",children:s.map((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function x(e){const t=b(e);return(0,y.jsxs)("div",{className:(0,i.A)("tabs-container",g.tabList),children:[(0,y.jsx)(w,{...t,...e}),(0,y.jsx)(v,{...t,...e})]})}function j(e){const t=(0,f.A)();return(0,y.jsx)(x,{...e,children:d(e.children)},String(t))}},19365:(e,t,n)=>{n.d(t,{A:()=>r});n(96540);var a=n(34164);const i={tabItem:"tabItem_Ymn6"};var s=n(74848);function r({children:e,hidden:t,className:n}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.A)(i.tabItem,n),hidden:t,children:e})}},20596:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/new_state-6f5fe53dd837ffd4cc0f1652875f27f6.gif"},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var a=n(96540);const i={},s=a.createContext(i);function r(e){const t=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:t},e.children)}},36573:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/keyboard_input-712fec91c9162efa6d2cfa3a805b0190.png"},37314:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/add_parameter-8598693e164e6ceda82226744cec409f.png"},58085:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/add_transition-90e23375523769b33b16303495e19bf9.gif"},66708:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/complete_anim_component-2b9b3b75c993013bc208f51c0c536a73.png"},72075:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"tutorials/anim-blending","title":"Anim State Graph Blending","description":"Click on screen to focus, then press the \'p\' key to blend to a punch animation.","source":"@site/docs/tutorials/anim-blending.md","sourceDirName":"tutorials","slug":"/tutorials/anim-blending","permalink":"/tutorials/anim-blending","draft":false,"unlisted":false,"editUrl":"https://github.com/playcanvas/developer.playcanvas.com/tree/dev/docs/tutorials/anim-blending.md","tags":[{"inline":true,"label":"animation","permalink":"/tags/animation"},{"inline":true,"label":"basics","permalink":"/tags/basics"}],"version":"current","frontMatter":{"title":"Anim State Graph Blending","tags":["animation","basics"],"thumb":"https://s3-eu-west-1.amazonaws.com/images.playcanvas.com/projects/12/405874/A8B1FE-image-75.jpg"},"sidebar":"tutorialsSidebar","previous":{"title":"Advance loading screen","permalink":"/tutorials/advance-loading-screen"},"next":{"title":"Animate entities with curves","permalink":"/tutorials/animate-entities-with-curves"}}');var i=n(74848),s=n(28453),r=n(11470),o=n(19365);const l={title:"Anim State Graph Blending",tags:["animation","basics"],thumb:"https://s3-eu-west-1.amazonaws.com/images.playcanvas.com/projects/12/405874/A8B1FE-image-75.jpg"},c=void 0,h={},d=[{value:"The Animstategraph Asset",id:"the-animstategraph-asset",level:2},{value:"The Anim Component",id:"the-anim-component",level:2},{value:"Keyboard Input",id:"keyboard-input",level:2}];function u(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"iframe-container",children:(0,i.jsx)("iframe",{src:"https://playcanv.as/p/HI8kniOx/",title:"Anim State Graph Blending",allow:"camera; microphone; xr-spatial-tracking; fullscreen",allowfullscreen:!0})}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsx)(t.p,{children:"Click on screen to focus, then press the 'p' key to blend to a punch animation."})}),"\n",(0,i.jsx)(t.p,{children:"This tutorial illustrates the basics of animation blending."}),"\n",(0,i.jsx)(t.p,{children:"Objects in your scene may be animated; machines or characters are good examples of things that you might want to animate. Generally, when 3D content is created, individual animations are authored and these animations are typically referred to as cycles (because they loop). For example, a human character could have an idle cycle, a walk cycle, a run cycle and so on. As a PlayCanvas developer, you'll want a mechanism to play these animations back on your animated object. Additionally, you do not want these animations to 'pop' as one is switched for another. To remedy this, you should use animation blending which implements a smooth transition from one animation to another. This dramatically improves the visual fidelity of your animated object.\nLet's examine how this is achieved via PlayCanvas..."}),"\n",(0,i.jsx)(t.h2,{id:"the-animstategraph-asset",children:"The Animstategraph Asset"}),"\n",(0,i.jsx)(t.p,{children:"In order to add animations to a model, we must first create an animstategraph asset. These assets control multiple animations associated with a single entity, determine when each of those animations should play and how they should be blended together."}),"\n",(0,i.jsx)(t.p,{children:"When creating an animstategraph asset, you\u2019ll be presented with its editor:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Initial Editor",src:n(10903).A+"",width:"3584",height:"1972"})}),"\n",(0,i.jsxs)(t.p,{children:["By default, the animstategraph asset creates a single animation state called \u2018Initial State\u2019 which has a default transition from the START state to it. This means when the animstategraph first begins playing, it\u2019ll immediately begin playing the Initial State. This can be renamed to Idle which is the name of the initial animation used in this tutorial. We can then right click the canvas and select ",(0,i.jsx)(t.code,{children:"Add new state"})," to create another animation state in the graph. This state can be renamed to Punch:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"New State",src:n(20596).A+"",width:"1600",height:"879"})}),"\n",(0,i.jsxs)(t.p,{children:["Next we must tell the state graph how and when it should move between the Idle and Punch animation states. This is achieved by creating transitions. Right click the Idle animation and select ",(0,i.jsx)(t.code,{children:"Add transition"})," from the context menu, then select the Punch animation state. This will create a transition moving from the Idle state to the Punch state."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Add Transition",src:n(58085).A+"",width:"1600",height:"847"})}),"\n",(0,i.jsx)(t.p,{children:"Selecting this transition will show the transition inspector in the panel to the right. Here the duration of the transition can be set, which will determine how long the blend between the two animations should last. We\u2019ll set this to 0.2 seconds."}),"\n",(0,i.jsxs)(t.p,{children:["Next, we can set up a parameter which will determine when this transition can activate. First select the ",(0,i.jsx)(t.code,{children:"+ parameter"})," on the parameters panel to the left. Then name this parameter ",(0,i.jsx)(t.code,{children:"punch"})," and set it to the \u2018Boolean\u2019 type."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Add Parameter",src:n(37314).A+"",width:"616",height:"340"})}),"\n",(0,i.jsxs)(t.p,{children:["This parameter can now be set as a condition for the transition we just created. Select this transition then select ",(0,i.jsx)(t.code,{children:"New Condition"})," in the transition inspector."]}),"\n",(0,i.jsxs)(t.p,{children:["Set this transition to test against the newly created ",(0,i.jsx)(t.code,{children:"punch"})," parameter and set the condition to \u2018== true\u2019 as follows:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Add Condition",src:n(1840).A+"",width:"510",height:"644"})}),"\n",(0,i.jsx)(t.p,{children:"This will ensure that the transition from the Idle state to the Punch state only occurs once the punch parameter has been set to true."}),"\n",(0,i.jsx)(t.p,{children:"Lastly, we need to create one more transition moving back from Punch to Idle as follows:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Complete State Graph",src:n(86729).A+"",width:"3580",height:"1970"})}),"\n",(0,i.jsx)(t.p,{children:"Here we have set it up with the same duration but its condition tests whether the punch parameter is no longer true."}),"\n",(0,i.jsx)(t.p,{children:"Now with this complete animstategraph, we must connect it to animation assets and the chosen entity. This is where the anim component comes in."}),"\n",(0,i.jsx)(t.h2,{id:"the-anim-component",children:"The Anim Component"}),"\n",(0,i.jsx)(t.p,{children:"First, we must add the anim component to our chosen entity."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"New Anim Component",src:n(11237).A+"",width:"620",height:"434"})}),"\n",(0,i.jsx)(t.p,{children:"Once created it\u2019ll display a slot for the animstategraph asset we just created. Drag this in and it\u2019ll display animation slots for each of the animation states present in it. In this case it\u2019ll have slots for the Idle and Punch states. Fill these slots with the appropriate animation assets and the anim component will become playable:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Complete Anim Component",src:n(66708).A+"",width:"614",height:"998"})}),"\n",(0,i.jsx)(t.h2,{id:"keyboard-input",children:"Keyboard Input"}),"\n",(0,i.jsxs)(t.p,{children:["With the animations fully set up, we now need to make it possible for users to interact with our system. This is where scripts come in! A script component is required to enable this behavior which will be written in the script ",(0,i.jsx)(t.code,{children:"keyboard_controls.js"}),". You can see how it\u2019s attached to the entity below:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Keyboard Input",src:n(36573).A+"",width:"750",height:"246"})}),"\n",(0,i.jsxs)(t.p,{children:["Remember that parameter ",(0,i.jsx)(t.code,{children:"punch"})," that we set up before? This script will simply toggle that parameter on and off depending on whether the \u2018P\u2019 key is currently pressed and whether the character is currently punching:"]}),"\n","\n",(0,i.jsxs)(r.A,{defaultValue:"classic",groupId:"script-code",children:[(0,i.jsx)(o.A,{value:"esm",label:"ESM",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"import { Script, EVENT_KEYDOWN, EVENT_KEYUP, KEY_P } from 'playcanvas';\n\nexport class KeyboardControls extends Script {\n    static scriptName = 'keyboardControls';\n\n    // initialize code called once per entity\n    initialize() {\n        this.app.keyboard.on(EVENT_KEYDOWN, this.keyDown, this);\n        this.app.keyboard.on(EVENT_KEYUP, this.keyUp, this);\n    }\n\n    update(dt) {\n        if (this.app.keyboard.wasPressed(KEY_P) && (this.entity.anim.baseLayer.activeState !== 'Punch')) {\n            this.entity.anim.setBoolean('punch', true);\n        }\n\n        if (this.app.keyboard.wasReleased(KEY_P) && (this.entity.anim.baseLayer.activeState === 'Punch')) {\n            this.entity.anim.setBoolean('punch', false);\n        }\n    }\n}\n"})})}),(0,i.jsx)(o.A,{value:"classic",label:"Classic",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"var KeyboardControls = pc.createScript('keyboardControls');\n\n// initialize code called once per entity\nKeyboardControls.prototype.initialize = function() {\n    this.app.keyboard.on(pc.EVENT_KEYDOWN, this.keyDown, this);\n    this.app.keyboard.on(pc.EVENT_KEYUP, this.keyUp, this);\n};\n\nKeyboardControls.prototype.update = function(dt) {\n    if (this.app.keyboard.wasPressed(pc.KEY_P) && (this.entity.anim.baseLayer.activeState !== 'Punch')) {\n        this.entity.anim.setBoolean('punch', true);\n    }\n\n    if (this.app.keyboard.wasReleased(pc.KEY_P) && (this.entity.anim.baseLayer.activeState === 'Punch')) {\n        this.entity.anim.setBoolean('punch', false);\n    }\n};\n"})})})]}),"\n",(0,i.jsx)(t.p,{children:"From this point, you are able to add more and more animations to the animstategraph asset and start building much more complex animation state graphs!"}),"\n",(0,i.jsxs)(t.p,{children:["See the full Scene ",(0,i.jsx)(t.a,{href:"https://playcanvas.com/editor/scene/1065029",children:"here"})]})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},86729:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/complete_state_graph-02221a825287977a2c01df16281bbb69.png"}}]);