"use strict";(globalThis.webpackChunkdeveloper_playcanvas_com=globalThis.webpackChunkdeveloper_playcanvas_com||[]).push([[25231],{28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>r});var t=i(96540);const s={},a=t.createContext(s);function c(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(a.Provider,{value:n},e.children)}},77180:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"user-manual/gaussian-splatting/building/picking","title":"Picking","description":"The PlayCanvas Engine provides a Picker API which can query the mesh instance rendered at a specified pixel. The picker works with splats in the same way that it does for meshes.","source":"@site/docs/user-manual/gaussian-splatting/building/picking.md","sourceDirName":"user-manual/gaussian-splatting/building","slug":"/user-manual/gaussian-splatting/building/picking","permalink":"/user-manual/gaussian-splatting/building/picking","draft":false,"unlisted":false,"editUrl":"https://github.com/playcanvas/developer.playcanvas.com/tree/dev/docs/user-manual/gaussian-splatting/building/picking.md","tags":[],"version":"current","frontMatter":{"title":"Picking"},"sidebar":"userManualSidebar","previous":{"title":"LOD Streaming","permalink":"/user-manual/gaussian-splatting/building/lod-streaming"},"next":{"title":"Shadows","permalink":"/user-manual/gaussian-splatting/building/shadows"}}');var s=i(74848),a=i(28453);const c={title:"Picking"},r=void 0,o={},l=[{value:"Setting Up the Picker",id:"setting-up-the-picker",level:2},{value:"Preparing for Picking",id:"preparing-for-picking",level:2},{value:"Identifying Picked Objects",id:"identifying-picked-objects",level:2},{value:"Getting World Position",id:"getting-world-position",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Debugging",id:"debugging",level:2}];function p(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["The PlayCanvas Engine provides a ",(0,s.jsx)(n.a,{href:"https://api.playcanvas.com/engine/classes/Picker.html",children:"Picker API"})," which can query the mesh instance rendered at a specified pixel. The picker works with splats in the same way that it does for meshes."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"https://playcanvas.github.io/#/gaussian-splatting/picking",children:"View Live Example"})})," - See splat picking in action with interactive selection and world position detection."]}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-the-picker",children:"Setting Up the Picker"}),"\n",(0,s.jsxs)(n.p,{children:["To pick splats, create a Picker instance with depth enabled (third parameter set to ",(0,s.jsx)(n.code,{children:"true"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Create a picker with depth buffer support for world position detection\nconst picker = new pc.Picker(app, 1, 1, true);\n"})}),"\n",(0,s.jsx)(n.p,{children:"The depth buffer is required if you want to retrieve the 3D world position of the picked point, not just identify which object was clicked."}),"\n",(0,s.jsx)(n.h2,{id:"preparing-for-picking",children:"Preparing for Picking"}),"\n",(0,s.jsxs)(n.p,{children:["Before querying the picker, you must render the ID texture by calling ",(0,s.jsx)(n.code,{children:"prepare()"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Get the layer containing your splats\nconst worldLayer = app.scene.layers.getLayerByName('World');\n\n// Render the picking buffer\npicker.prepare(camera.camera, app.scene, [worldLayer]);\n"})}),"\n",(0,s.jsx)(n.p,{children:"For better performance, you can resize the picker to use a lower resolution:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Use quarter resolution for faster picking\nconst pickerScale = 0.25;\npicker.resize(canvas.clientWidth * pickerScale, canvas.clientHeight * pickerScale);\n\n// Scale the pick coordinates accordingly\nconst scaledX = mouseX * pickerScale;\nconst scaledY = mouseY * pickerScale;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"identifying-picked-objects",children:"Identifying Picked Objects"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"getSelectionAsync()"})," to get the mesh instances at a screen position:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const meshInstances = await picker.getSelectionAsync(x, y, 1, 1);\nif (meshInstances.length > 0) {\n    const meshInstance = meshInstances[0];\n    // Find the entity that owns this mesh instance\n    const pickedEntity = findEntityByMeshInstance(meshInstance);\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["To match a mesh instance to its owning GSplat entity, compare against the ",(0,s.jsx)(n.code,{children:"gsplat.instance.meshInstance"})," property:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Find entity with matching mesh instance\nconst entity = entities.find(e => e.gsplat.instance.meshInstance === meshInstance);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"getting-world-position",children:"Getting World Position"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"getWorldPointAsync()"})," to get the 3D world position of a picked point:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const worldPoint = await picker.getWorldPointAsync(x, y);\nif (worldPoint) {\n    // worldPoint is a Vec3 containing the 3D position\n    console.log('Picked position:', worldPoint.x, worldPoint.y, worldPoint.z);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,s.jsx)(n.p,{children:"Here's a typical picking workflow combining object identification and world position:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const handlePick = async (mouseX, mouseY) => {\n    // Use lower resolution for performance\n    const pickerScale = 0.25;\n    picker.resize(canvas.clientWidth * pickerScale, canvas.clientHeight * pickerScale);\n\n    // Prepare the picker\n    const worldLayer = app.scene.layers.getLayerByName('World');\n    picker.prepare(camera.camera, app.scene, [worldLayer]);\n\n    const x = mouseX * pickerScale;\n    const y = mouseY * pickerScale;\n\n    // Get the world position\n    const worldPoint = await picker.getWorldPointAsync(x, y);\n    if (!worldPoint) return;\n\n    // Get the picked object\n    const meshInstances = await picker.getSelectionAsync(x, y, 1, 1);\n    if (meshInstances.length === 0) return;\n\n    const meshInstance = meshInstances[0];\n\n    // Find the gsplat entity that owns this mesh instance\n    const entity = splatEntities.find(\n        e => e.gsplat.instance.meshInstance === meshInstance\n    );\n\n    if (entity) {\n        // Convert world position to entity's local space if needed\n        const localPos = entity.getWorldTransform()\n            .clone()\n            .invert()\n            .transformPoint(worldPoint);\n\n        console.log('Picked entity:', entity.name);\n        console.log('Local position:', localPos);\n    }\n};\n\n// Handle mouse clicks\napp.mouse.on(pc.EVENT_MOUSEDOWN, (event) => {\n    handlePick(event.x, event.y);\n});\n\n// Handle touch events\napp.touch.on(pc.EVENT_TOUCHSTART, (event) => {\n    const touch = event.touches[0];\n    handlePick(touch.x, touch.y);\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,s.jsx)(n.p,{children:"The picker exposes its internal buffers which can be useful for debugging:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Display the color buffer (object IDs)\nif (picker.colorBuffer) {\n    app.drawTexture(0.55, -0.77, 0.2, 0.2, picker.colorBuffer);\n}\n\n// Display the depth buffer\nif (picker.depthBuffer) {\n    app.drawTexture(0.77, -0.77, 0.2, 0.2, picker.depthBuffer);\n}\n"})})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}}}]);