"use strict";(self.webpackChunkdeveloper_playcanvas_com=self.webpackChunkdeveloper_playcanvas_com||[]).push([[51503],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(96540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},50672:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"user-manual/scripting/migration-guide","title":"Migration Guide","description":"ESM Scripts replace the older Classic Scripting system as the recommended way to develop PlayCanvas applications. Whilst classic scripts will continue to work in existing projects and will be supported for the foreseeable future, we recommend using the newer ESM format for your projects.","source":"@site/docs/user-manual/scripting/migration-guide.md","sourceDirName":"user-manual/scripting","slug":"/user-manual/scripting/migration-guide","permalink":"/user-manual/scripting/migration-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/playcanvas/developer.playcanvas.com/tree/dev/docs/user-manual/scripting/migration-guide.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Migration Guide","sidebar_position":4},"sidebar":"userManualSidebar","previous":{"title":"Browser Dev Tools","permalink":"/user-manual/scripting/debugging/browser-dev-tools"},"next":{"title":"Graphics","permalink":"/user-manual/graphics/"}}');var i=t(74848),r=t(28453);const o={title:"Migration Guide",sidebar_position:4},a=void 0,c={},d=[{value:"Gradual Migration",id:"gradual-migration",level:2},{value:"Codemod",id:"codemod",level:2},{value:"Known differences",id:"known-differences",level:2},{value:"Module Scope",id:"module-scope",level:3},{value:"Loading Order",id:"loading-order",level:3},{value:"The New <code>Script</code> Class",id:"the-new-script-class",level:3},{value:"Attribute Events",id:"attribute-events",level:4},{value:"Attribute Copying",id:"attribute-copying",level:4}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"ESM Scripts replace the older Classic Scripting system as the recommended way to develop PlayCanvas applications. Whilst classic scripts will continue to work in existing projects and will be supported for the foreseeable future, we recommend using the newer ESM format for your projects."}),"\n",(0,i.jsx)(n.h2,{id:"gradual-migration",children:"Gradual Migration"}),"\n",(0,i.jsx)(n.p,{children:"Using ESM Scripts within your project is entirely optional and allows you to gradually migrate your projects over to the newer ESM based format in your own time, without affecting existing projects."}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Projects can contain both ESM Scripts and Classic Scripts"})}),(0,i.jsx)(n.p,{children:"You do not need to update all your scripts together. We recommend gradually migrating scripts and iteratively testing"})]}),"\n",(0,i.jsx)(n.h2,{id:"codemod",children:"Codemod"}),"\n",(0,i.jsxs)(n.p,{children:["In order to migrate Classic Scripts to the ESM format, we've provided a ",(0,i.jsx)(n.a,{href:"https://codemod.com/registry/playcanvas-esm-scripts",children:"codemod"})," that will automatically update your code."]}),"\n",(0,i.jsxs)(n.p,{children:["You can find the codemods in our ",(0,i.jsx)(n.a,{href:"https://github.com/playcanvas/codemods",children:"github repository"})," and you can run the codemod using the following command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx codemod playcanvas-esm-scripts\n"})}),"\n",(0,i.jsx)(n.h2,{id:"known-differences",children:"Known differences"}),"\n",(0,i.jsx)(n.p,{children:"In general, ESM Scripts provide a more expressive and flexible way of creating projects. Whilst we have attempted to keep the migration process as seamless as possible, there are some notable differences that you should bear in mind."}),"\n",(0,i.jsx)(n.h3,{id:"module-scope",children:"Module Scope"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"ESM Scripts have module scope, Classic Scripts have global scope"}),". This means modules cannot implicitly access variables defined in other files. Often this is used as a way to define global settings or configuration. The config has a higher loading order than the script, and so the ",(0,i.jsx)(n.code,{children:"SPEED"})," is accessible globally."]}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(n.strong,{children:"See code example"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// config.js\nvar SPEED = 10;\n\n// script.js\n// \u274c This will not work. `SPEED` is scoped to config.js\nconsole.log(SPEED)\n"})}),(0,i.jsxs)(n.p,{children:["This is a ",(0,i.jsx)(n.em,{children:"hidden dependency"})," which breaks if the loading order changes. Instead, use ",(0,i.jsx)(n.code,{children:"import/export"})," syntax to explicitly define the dependency."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// config.mjs\nexport const SPEED = 10\n\n// script.mjs\nimport { SPEED } from './config.mjs';\n// \u2705 Works!\nconsole.log(SPEED); \n"})})]}),"\n",(0,i.jsxs)(n.p,{children:["You can learn more about the other difference between ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules#other_differences_between_modules_and_standard_scripts",children:"ES Modules and standard scripts here"})]}),"\n",(0,i.jsx)(n.h3,{id:"loading-order",children:"Loading Order"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"ESM Script do not have a loading order."})})}),"\n",(0,i.jsxs)(n.p,{children:["The loading order of scripts was introduced as a way to organize dependencies between scripts and guarantee certain code would executed before others. With ES modules, these relationships can be explicitly defined through ",(0,i.jsx)(n.code,{children:"import/export"})," syntax. As such, ESM Scripts do not have an loading order and they should not be relied upon to load in a certain way. Instead we encourage you to use ",(0,i.jsx)(n.code,{children:"import/export"})," statements to set up dependencies."]}),"\n",(0,i.jsxs)(n.h3,{id:"the-new-script-class",children:["The New ",(0,i.jsx)(n.code,{children:"Script"})," Class"]}),"\n",(0,i.jsxs)(n.p,{children:["With ESM Scripts, the new ",(0,i.jsx)(n.code,{children:"Script"})," base class replaces the existing ",(0,i.jsx)(n.code,{children:"ScriptType"})," class as the default base class. The ",(0,i.jsx)(n.code,{children:"Script"})," class represents the minimal set of features necessary, but omits a couple of features present in the original ",(0,i.jsx)(n.code,{children:"ScriptType"})," class."]}),"\n",(0,i.jsxs)(n.p,{children:["It's worth noting that although ",(0,i.jsx)(n.code,{children:"Script"})," is now the default base class, it's still possible to use ",(0,i.jsx)(n.code,{children:"ScriptType"})," as the base class (internally ",(0,i.jsx)(n.code,{children:"ScriptType"})," extends ",(0,i.jsx)(n.code,{children:"Script"}),"), however we do not recommend doing this for ESM Scripts, due to some of the reasons listed below."]}),"\n",(0,i.jsx)(n.h4,{id:"attribute-events",children:"Attribute Events"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"ESM Script do not fire Attribute Events."})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Script"})," class does not support attributes events in the format of ",(0,i.jsx)(n.code,{children:"attr:[name]"}),". The reason behind removing this is that, internally, the engine would override class members, and in practice this would create difficult-to-debug scenarios as it's not fully compatible with ",(0,i.jsx)(n.a,{href:"https://github.com/playcanvas/engine/issues/6316",children:"ES6 class syntax"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Instead, you can define your own events around class attribute members using something like the following;"}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(n.strong,{children:"See code example"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const watch = (target, prop) => {\n    const privateProp = `#{prop}`;\n    target[privateProp] = target[prop];\n\n    Object.defineProperty(target, prop, {\n        set(value) {\n            if (target[privateProp] !== value) {\n                target.fire(`changed:${prop}`, value);\n                target[privateProp] = value;\n            }\n        },\n        get() {\n            return this[privateProp];\n        }\n    });\n}\n\nimport { Script } from 'playcanvas'\n\nexport class Rotate extends Script {\n    static scriptName = 'rotate';\n\n    /** attribute */\n    speed = 10;\n\n    initialize() {\n        watch(this, 'speed');\n\n        this.on('changed:speed', console.log)\n    }\n}\n\n"})})]}),"\n",(0,i.jsx)(n.p,{children:"This also means you can have events for any class members too, not only script attributes."}),"\n",(0,i.jsx)(n.h4,{id:"attribute-copying",children:"Attribute Copying"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"ESM Script Attributes are not copied, they are passed by reference."})})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Attributes are no longer copied, they are passed by reference."})," The reasons this was changed was also due to a ",(0,i.jsxs)(n.a,{href:"https://github.com/playcanvas/engine/issues/6316",children:["bug in ",(0,i.jsx)(n.code,{children:"ScriptType"})]})," that was incompatible with ES6 classes."]}),"\n",(0,i.jsx)(n.p,{children:"Instead, if you do need to copy values, we recommend you do it manually and explicitly via getters and setters. Whilst this is more verbose, it's clear and explicit."}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(n.strong,{children:"See code example"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import { Script, Vec3 } from 'playcanvas';\n\nexport class Rotate extends Script {\n    static scriptName = 'rotate';\n\n    _speed = new Vec3();\n\n    set speed(value) {\n        this._speed.copy(value)\n    }\n\n    get speed() {\n        return this._speed;\n    }\n}\n"})})]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);