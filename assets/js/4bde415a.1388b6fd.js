"use strict";(self.webpackChunkdeveloper_playcanvas_com=self.webpackChunkdeveloper_playcanvas_com||[]).push([[44191],{260:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"user-manual/scripting/editor-users/hot-reloading","title":"Hot Reloading","description":"When you are iterating on a complex project it can be frustrating to have to do a full page refresh every time you make a change to a script. Especially if it takes you a long time to get to the point where you are testing your code. That is where hot-swapping of code comes in.","source":"@site/docs/user-manual/scripting/editor-users/hot-reloading.md","sourceDirName":"user-manual/scripting/editor-users","slug":"/user-manual/scripting/editor-users/hot-reloading","permalink":"/user-manual/scripting/editor-users/hot-reloading","draft":false,"unlisted":false,"editUrl":"https://github.com/playcanvas/developer.playcanvas.com/tree/dev/docs/user-manual/scripting/editor-users/hot-reloading.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Hot Reloading","sidebar_position":5},"sidebar":"userManualSidebar","previous":{"title":"VS Code Extension","permalink":"/user-manual/scripting/editor-users/vscode-extension"},"next":{"title":"Script Loading Order","permalink":"/user-manual/scripting/editor-users/loading-order"}}');var r=n(74848),o=n(28453),s=n(65537),i=n(79329);const l={title:"Hot Reloading",sidebar_position:5},c=void 0,d={},u=[{value:"How to Use Hot-swapping",id:"how-to-use-hot-swapping",level:2}];function p(e){const t={code:"code",em:"em",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"When you are iterating on a complex project it can be frustrating to have to do a full page refresh every time you make a change to a script. Especially if it takes you a long time to get to the point where you are testing your code. That is where hot-swapping of code comes in."}),"\n",(0,r.jsx)(t.h2,{id:"how-to-use-hot-swapping",children:"How to Use Hot-swapping"}),"\n",(0,r.jsxs)(t.p,{children:["Hot-swapping is enabled on a per-script basis. To enable it, all you need to do is implement the ",(0,r.jsx)(t.code,{children:"swap()"})," method in your script."]}),"\n","\n",(0,r.jsxs)(s.A,{defaultValue:"esm",groupId:"script-code",children:[(0,r.jsx)(i.A,{value:"esm",label:"ESM",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"    swap(old) {\n        // Recover state here\n    }\n"})})}),(0,r.jsx)(i.A,{value:"classic",label:"Classic",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"MyScript.prototype.swap = function(old) {\n    // Recover state here\n};\n"})})})]}),"\n",(0,r.jsxs)(t.p,{children:["When a script with a ",(0,r.jsx)(t.code,{children:"swap"})," function is changed in the code editor, any launched applications will reload the script and add it to script registry. Then it creates brand new script instances to swap with the old ones, calling the ",(0,r.jsx)(t.code,{children:"swap"})," method during that process per each instance. The ",(0,r.jsx)(t.code,{children:"initialize"})," method of the script is ",(0,r.jsx)(t.em,{children:"not"})," called again. Instead, the old script instance is passed into the ",(0,r.jsx)(t.code,{children:"swap"})," method and it is up to the developer to ensure that the state of the old script is copied into the new one. Declared script attributes are automatically copied over into the new script instance. It is also important to remove any event listeners from the old instance and re-attach them to the new one."]}),"\n",(0,r.jsx)(t.p,{children:"For example:"}),"\n",(0,r.jsxs)(s.A,{defaultValue:"esm",groupId:"script-code",children:[(0,r.jsx)(i.A,{value:"esm",label:"ESM",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"import { ScriptType, math } from 'playcanvas';\n\nexport class Rotator extends Script {\n    /**\n     * @attribute\n     */\n    xSpeed = 10;\n\n    initialize() {\n        // Listen for enable event and call method\n        this.on('enable', this._onEnable);\n\n        this.ySpeed = 0;\n    }\n\n    swap(old) {\n        // xSpeed is an attribute and so is automatically copied\n\n        // Copy the ySpeed property from the old script instance to the new one\n        this.ySpeed = old.ySpeed;\n\n        // Remove the old event listener\n        old.off('enable', old._onEnable);\n        // Add a new event listener\n        this.on('enable', this._onEnable);\n    }\n\n    _onEnable() {\n        // When enabled, randomize the speed\n        this.ySpeed = math.random(0, 10);\n    }\n\n    update(dt) {\n        this.entity.rotate(this.xSpeed * dt, this.ySpeed * dt, 0);\n    }\n}\n"})})}),(0,r.jsx)(i.A,{value:"classic",label:"Classic",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"var Rotator = pc.createScript('rotator');\n\nRotator.attributes.add('xSpeed', { type: 'number', default: 10 });\n\nRotator.prototype.initialize = function () {\n    // Listen for enable event and call method\n    this.on('enable', this._onEnable);\n\n    this.ySpeed = 0;\n};\n\nRotator.prototype.swap = function (old) {\n    // xSpeed is an attribute and so is automatically copied\n\n    // Copy the ySpeed property from the old script instance to the new one\n    this.ySpeed = old.ySpeed;\n\n    // Remove the old event listener\n    old.off('enable', old._onEnable);\n    // Add a new event listener\n    this.on('enable', this._onEnable);\n};\n\nRotator.prototype._onEnable = function () {\n    // When enabled randomize the speed\n    this.ySpeed = pc.math.random(0, 10);\n}\n\nRotator.prototype.update = function (dt) {\n    this.entity.rotate(this.xSpeed * dt, this.ySpeed * dt, 0);\n};\n"})})})]}),"\n",(0,r.jsxs)(t.p,{children:["Try changing logic within the ",(0,r.jsx)(t.code,{children:"update"})," method and save the code. The launched application will automatically swap ",(0,r.jsx)(t.code,{children:"rotator"})," script instances with new ones and your application will keep working with the new logic."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"swap"})," method is called regardless of the running state of a script instance, so if it was disabled due to an error it can be re-enabled in the ",(0,r.jsx)(t.code,{children:"swap"})," method."]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>i});var a=n(96540);const r={},o=a.createContext(r);function s(e){const t=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(o.Provider,{value:t},e.children)}},65537:(e,t,n)=>{n.d(t,{A:()=>j});var a=n(96540),r=n(34164),o=n(65627),s=n(56347),i=n(50372),l=n(30604),c=n(11861),d=n(78749);function u(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??function(e){return u(e).map((({props:{value:e,label:t,attributes:n,default:a}})=>({value:e,label:t,attributes:n,default:a})))}(n);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h({value:e,tabValues:t}){return t.some((t=>t.value===e))}function m({queryString:e=!1,groupId:t}){const n=(0,s.W6)(),r=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,l.aZ)(r),(0,a.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(n.location.search);t.set(r,e),n.replace({...n.location,search:t.toString()})}),[r,n])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,o=p(e),[s,l]=(0,a.useState)((()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find((e=>e.default))??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:o}))),[c,u]=m({queryString:n,groupId:r}),[f,b]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,r]=(0,d.Dv)(t);return[n,(0,a.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:r}),g=(()=>{const e=c??f;return h({value:e,tabValues:o})?e:null})();(0,i.A)((()=>{g&&l(g)}),[g]);return{selectedValue:s,selectValue:(0,a.useCallback)((e=>{if(!h({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),b(e)}),[u,b,o]),tabValues:o}}var b=n(9136);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=n(74848);function y({className:e,block:t,selectedValue:n,selectValue:a,tabValues:s}){const i=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),c=e=>{const t=e.currentTarget,r=i.indexOf(t),o=s[r].value;o!==n&&(l(t),a(o))},d=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=i.indexOf(e.currentTarget)+1;t=i[n]??i[0];break}case"ArrowLeft":{const n=i.indexOf(e.currentTarget)-1;t=i[n]??i[i.length-1];break}}t?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},e),children:s.map((({value:e,label:t,attributes:a})=>(0,v.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{i.push(e)},onKeyDown:d,onClick:c,...a,className:(0,r.A)("tabs__item",g.tabItem,a?.className,{"tabs__item--active":n===e}),children:t??e},e)))})}function w({lazy:e,children:t,selectedValue:n}){const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=o.find((e=>e.props.value===n));return e?(0,a.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==n})))})}function x(e){const t=f(e);return(0,v.jsxs)("div",{className:(0,r.A)("tabs-container",g.tabList),children:[(0,v.jsx)(y,{...t,...e}),(0,v.jsx)(w,{...t,...e})]})}function j(e){const t=(0,b.A)();return(0,v.jsx)(x,{...e,children:u(e.children)},String(t))}},79329:(e,t,n)=>{n.d(t,{A:()=>s});n(96540);var a=n(34164);const r={tabItem:"tabItem_Ymn6"};var o=n(74848);function s({children:e,hidden:t,className:n}){return(0,o.jsx)("div",{role:"tabpanel",className:(0,a.A)(r.tabItem,n),hidden:t,children:e})}}}]);