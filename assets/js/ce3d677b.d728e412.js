"use strict";(globalThis.webpackChunkdeveloper_playcanvas_com=globalThis.webpackChunkdeveloper_playcanvas_com||[]).push([[84416],{28453:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>t});var a=n(96540);const s={},o=a.createContext(s);function c(e){const r=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),a.createElement(o.Provider,{value:r},e.children)}},64094:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>i,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"user-manual/graphics/cameras/depth-layer","title":"Depth Layer","description":"Some rendering techniques require access to the depth or the color buffer of the scene for a specific camera. The Depth Layer is a special layer, which can be added to the layers property of a camera. The order of the layers defines at which point during the rendering, the depth or the color buffer is captured. The captured buffers can then be used in the following layers of the camera.","source":"@site/docs/user-manual/graphics/cameras/depth-layer.md","sourceDirName":"user-manual/graphics/cameras","slug":"/user-manual/graphics/cameras/depth-layer","permalink":"/user-manual/graphics/cameras/depth-layer","draft":false,"unlisted":false,"editUrl":"https://github.com/playcanvas/developer.playcanvas.com/tree/dev/docs/user-manual/graphics/cameras/depth-layer.md","tags":[],"version":"current","frontMatter":{"title":"Depth Layer"},"sidebar":"userManualSidebar","previous":{"title":"Cameras","permalink":"/user-manual/graphics/cameras/"},"next":{"title":"Scene Picker","permalink":"/user-manual/graphics/cameras/scene-picker"}}');var s=n(74848),o=n(28453);const c={title:"Depth Layer"},t=void 0,i={},l=[{value:"Buffer access",id:"buffer-access",level:2},{value:"Color Space Handling",id:"color-space-handling",level:2},{value:"SCENE_COLORMAP_GAMMA Define",id:"scene_colormap_gamma-define",level:3},{value:"CameraFrame Integration",id:"cameraframe-integration",level:2},{value:"Examples",id:"examples",level:2}];function d(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.p,{children:["Some rendering techniques require access to the depth or the color buffer of the scene for a specific camera. The Depth Layer is a special layer, which can be added to the ",(0,s.jsx)(r.code,{children:"layers"})," property of a camera. The ",(0,s.jsx)(r.a,{href:"/user-manual/graphics/layers/#choosing-the-layer-order",children:(0,s.jsx)(r.code,{children:"order"})})," of the layers defines at which point during the rendering, the depth or the color buffer is captured. The captured buffers can then be used in the following layers of the camera."]}),"\n",(0,s.jsx)(r.p,{children:"Typically, those buffers are captured after all opaque layers are rendered and can be used in following transparent layers or post-processing."}),"\n",(0,s.jsx)(r.p,{children:"Additionally, to capture these buffers, the capture needs to be enabled on a CameraComponent from a script:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"https://api.playcanvas.com/engine/classes/CameraComponent.html#requestscenecolormap",children:(0,s.jsx)(r.code,{children:"requestSceneColorMap"})})," to request a color map"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"https://api.playcanvas.com/engine/classes/CameraComponent.html#requestscenedepthmap",children:(0,s.jsx)(r.code,{children:"requestSceneDepthMap"})})," to request a depth map"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"buffer-access",children:"Buffer access"}),"\n",(0,s.jsx)(r.p,{children:"To access one of these buffers in the shader as a texture, these are the uniform names to be used:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["for the color map: ",(0,s.jsx)(r.code,{children:"uSceneColorMap"})]}),"\n",(0,s.jsxs)(r.li,{children:["for the depth map: ",(0,s.jsx)(r.code,{children:"uSceneDepthMap"})]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"color-space-handling",children:"Color Space Handling"}),"\n",(0,s.jsxs)(r.p,{children:["When using ",(0,s.jsx)(r.code,{children:"uSceneColorMap"}),", it's important to handle color space correctly. The scene color texture contains either gamma-corrected values (when rendering LDR to a non-sRGB target) or linear values (when using HDR rendering with CameraFrame)."]}),"\n",(0,s.jsx)(r.h3,{id:"scene_colormap_gamma-define",children:"SCENE_COLORMAP_GAMMA Define"}),"\n",(0,s.jsxs)(r.p,{children:["The engine automatically provides a ",(0,s.jsx)(r.code,{children:"SCENE_COLORMAP_GAMMA"})," shader define when the scene color map contains gamma-corrected values that need to be converted to linear space. This typically occurs during LDR rendering when the camera outputs gamma-corrected colors to a standard (non-sRGB) render target."]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"GLSL Example:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-glsl",children:"vec3 sceneColor = texture2DLod(uSceneColorMap, uv, 0.0).rgb;\n\n#ifdef SCENE_COLORMAP_GAMMA\n// Convert from gamma to linear space\nsceneColor = decodeGamma(sceneColor);\n#endif\n\n// Now sceneColor is in linear space for lighting calculations\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"WGSL Example:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-wgsl",children:"var sceneColor: vec3f = textureSampleLevel(uSceneColorMap, uSceneColorMapSampler, uv, 0.0).rgb;\n\n#ifdef SCENE_COLORMAP_GAMMA\n// Convert from gamma to linear space\nsceneColor = decodeGamma3(sceneColor);\n#endif\n\n// Now sceneColor is in linear space for lighting calculations\n"})}),"\n",(0,s.jsxs)(r.p,{children:["The ",(0,s.jsx)(r.code,{children:"decodeGamma()"})," and ",(0,s.jsx)(r.code,{children:"decodeGamma3()"})," functions are built-in utility functions that perform the gamma-to-linear conversion using the standard gamma 2.2 curve."]}),"\n",(0,s.jsxs)(r.p,{children:["For more information on linear workflow and color space handling, see the ",(0,s.jsx)(r.a,{href:"/user-manual/graphics/linear-workflow/",children:"Linear Workflow"})," documentation."]}),"\n",(0,s.jsx)(r.h2,{id:"cameraframe-integration",children:"CameraFrame Integration"}),"\n",(0,s.jsxs)(r.p,{children:["When using ",(0,s.jsx)(r.a,{href:"/user-manual/graphics/posteffects/cameraframe/",children:(0,s.jsx)(r.code,{children:"CameraFrame"})})," for HDR post-processing, you can request depth and color maps through the ",(0,s.jsx)(r.a,{href:"https://api.playcanvas.com/engine/classes/CameraFrame.html#rendering",children:(0,s.jsx)(r.code,{children:"rendering"})})," settings:"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Color Map"}),": Set ",(0,s.jsx)(r.code,{children:"cameraFrame.rendering.sceneColorMap = true"})," to enable access to ",(0,s.jsx)(r.code,{children:"uSceneColorMap"})," (e.g., for refraction or custom post-processing effects)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Depth Map"}),": Set ",(0,s.jsx)(r.code,{children:"cameraFrame.rendering.sceneDepthMap = true"})," to enable access to ",(0,s.jsx)(r.code,{children:"uSceneDepthMap"})," (e.g., for depth-dependent effects like custom fog or edge detection)"]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["The color map in CameraFrame contains linear HDR values (no gamma correction needed), so the ",(0,s.jsx)(r.code,{children:"SCENE_COLORMAP_GAMMA"})," define will not be set. This ensures consistent color space handling across different rendering configurations."]}),"\n",(0,s.jsx)(r.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(r.p,{children:"These engine examples demonstrate the rendering of both the depth and the color map, and also custom shaders allowing their use:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["GrabPass demonstrates the use of the color buffer: ",(0,s.jsx)(r.a,{href:"https://playcanvas.github.io/#/shaders/grab-pass",children:(0,s.jsx)(r.code,{children:"GrabPass"})})]}),"\n",(0,s.jsxs)(r.li,{children:["GroundFog demonstrates the use of the depth buffer: ",(0,s.jsx)(r.a,{href:"https://playcanvas.github.io/#/shaders/ground-fog",children:(0,s.jsx)(r.code,{children:"GroundFog"})})]}),"\n",(0,s.jsxs)(r.li,{children:["Dispersion demonstrates refraction and chromatic dispersion using the scene color texture: ",(0,s.jsx)(r.a,{href:"https://playcanvas.github.io/#/materials/dispersion",children:(0,s.jsx)(r.code,{children:"Dispersion"})})]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);